<!DOCTYPE html>
<html>
	<head>
		<title>Tic Tac Toe</title>
		<link rel="icon" href="../assets/images/icon.png">
		<meta name="robots" content="noindex">
	</head>
	<body>
	go first or <button onclick="comsTurn(true)">let computer go first</button> <br><br>
		<canvas id="canvas" height="300" width="300"></canvas>
	</body>
	
	<script>
		// variables
		let placed = [0,0] // player, com
		let comMoves = [];
		let playerMoves = [];
		let isPlayerTurn = true;
		let playerChar = "X"; //Starting Player is X's
		let comChar = "O";
		
		// setup
		draw();
		// functions
		function draw() {
			const canvas = document.getElementById("canvas");
			currentChar = "";
			if (canvas.getContext) {
				const ctx = canvas.getContext("2d");
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				
				ctx.beginPath();
				ctx.moveTo(canvas.width/3, 0);
				ctx.lineTo(canvas.width/3, canvas.height);
				ctx.stroke();
				ctx.beginPath();
				ctx.moveTo(2*canvas.width/3, 0);
				ctx.lineTo(2*canvas.width/3, canvas.height);
				ctx.stroke();
				ctx.beginPath();
				ctx.moveTo(0, canvas.height/3);
				ctx.lineTo(canvas.width, canvas.height/3);
				ctx.stroke();
				ctx.beginPath();
				ctx.moveTo(0, 2*canvas.height/3);
				ctx.lineTo(canvas.width, 2*canvas.height/3);
				ctx.stroke();
				
				for(let i = 0; i < 3; i++){
					for(let j = 0; j<3; j++){
						if((placed[0] & 1 << i+j*3) != 0){
							currentChar = playerChar
						}

						else if((placed[1] & 1 << i+j*3) != 0){
							currentChar = comChar
						}
						else{
							currentChar = ""
						}
					
					
						if (currentChar == "X"){
							ctx.beginPath();
							ctx.moveTo(i*canvas.width/3, j*canvas.height/3);
							ctx.lineTo((i+1)*canvas.width/3, (j+1)*canvas.height/3);
							ctx.stroke();
							
							ctx.beginPath();
							ctx.moveTo(i*canvas.width/3, (j+1)*canvas.height/3);
							ctx.lineTo((i+1)*canvas.width/3, j*canvas.height/3);
							ctx.stroke();
						}
						else if (currentChar == "O"){
							ctx.beginPath();
							ctx.arc(i*canvas.width/3 + canvas.width/6, j*canvas.height/3 + canvas.height/6, canvas.width/6, 0, 2 * Math.PI);
							ctx.stroke();
						}
					}
				}
			}
		}
		
		function comsTurn(buttonPress){
			let x = 0;
			let y = 0;
			let possibleWins = 0;
			//check if com can win
			possibleWins = checkPossibleWins(1);
			
			if(possibleWins != 0){
				[x, y] = possibleWins
				comMoves.push([x, y]);
				placeShape(x,y,1)
				return;
			}
			//check if player can win
			possibleWins = checkPossibleWins(0);
			if(possibleWins != 0){
				[x, y] = possibleWins
				comMoves.push([x, y]);
				placeShape(x,y,1)
				return;
			}
			
			if (numPlaced(0) == 0 && numPlaced(1) == 0){ // first turn, com leads
				playerChar = "O";
				comChar = "X";
				x = Math.floor(Math.random() * 2)*2
				y = Math.floor(Math.random() * 2)*2
				comMoves.push([x, y]); //play in a random corner
				placeShape(x,y,1)
			}
			else if(numPlaced(0) == 1 && numPlaced(1) == 0){ // first turn, player leads
				
			}
			else if(numPlaced(0) == 1 && numPlaced(1) == 1){ // second turn, com leads
				if (checkPlace(1,1)){ // user placed in center
					x = comMoves[0][0]^0b10
					y = comMoves[0][1]^0b10
					comMoves.push([x, y]);
					placeShape(x,y,1)
				}
				// if player played center play in either oposite corner, or two spaces adjacent to oposite corner
				// else play in any corner not blocked by player move
			}
			else if(numPlaced(0) == 2 && numPlaced(1) == 1){ // second turn, player leads
			}
			else if(numPlaced(0) == 2 && numPlaced(1) == 2){ // third turn, com leads
			}
			else if(numPlaced(0) == 3 && numPlaced(1) == 2){ // third turn, player leads
			}
			else if(numPlaced(0) == 3 && numPlaced(1) == 3){ // fourth turn, com leads
			}
			else if(numPlaced(0) == 4 && numPlaced(1) == 3){ // fourth turn, player leads
			}
			else if(numPlaced(0) == 4 && numPlaced(1) == 4){ // fifth turn, com leads
			}
			else if(numPlaced(0) == 5 && numPlaced(1) == 4){ // fifth turn, player leads
			}
			
		}
		
		function numPlaced(value){
			let numPlacedValue = 0;
			for(let i = 0; i < 9; i++){
				if((placed[value] & 1 << i) != 0){
					numPlacedValue++;
				}
			}
			return numPlacedValue;
		}
		
		function checkPossibleWins(value){
			let placedInRow = 0;
			let placedInCol = 0;
			let placedInD1 = 0;
			let placedInD2 = 0;
			let emptyRowSpace = 0;
			let emptyColSpace = 0;
			let emptyD1Space = 0;
			let emptyD2Space = 0;
			
			for(let i = 0; i < 3; i++){
				for(let j = 0; j < 3; j++){
					if((placed[value] & (1<<j+i*3)) >> j+i*3 != 0){ // rows
						placedInRow++;
					}else if ((placed[value^1] & (1<<j+i*3)) >> j+i*3 == 0){
						emptyRowSpace = j;
					}else{
						placedInRow = 0;
					}
					
					if((placed[value] & (1<<i+j*3)) >> i+j*3 != 0){ // columns
						placedInCol++;
					}else if ((placed[value^1] & (1<<i+j*3)) >> i+j*3 == 0){
						emptyColSpace = j;
					}
					else{
						placedInCol = 0;
					}
				}
				if((placed[value] & (1<<(2-i)+i*3)) >> (2-i)+i*3 != 0){ // top right to bottom left
					placedInD1++;
				}else if ((placed[value^1] & (1<<(2-i)+i*3)) >> (2-i)+i*3 == 0){
					emptyD1Space = i;
				}
				else{
					placedInD1 = 0;
				}
				
				if((placed[value] & (1<<i+i*3)) >> i+i*3 != 0){ // top left to bottom right
					placedInD2++;
				}else if ((placed[value^1] & (1<<i+i*3)) >> i+i*3 == 0){
					emptyD2Space = i;
				}
				else{
					placedInD2 = 0;
				}
				
				if(placedInRow == 3 || placedInCol == 3 || placedInD1 == 3 || placedInD2 == 3){
					// win
				}
				
				if(placedInRow == 2){
					return [emptyRowSpace, i]
				}
				if(placedInCol == 2){
					return [i, emptyColSpace]
				}
				
				placedInRow = 0;
				placedInCol = 0;
			}
			if(placedInD1 == 2){
				return [2-emptyD1Space, emptyD1Space]
			}
			if(placedInD2 == 2){
				return [emptyD2Space, emptyD2Space]
			}
			return 0;
		}
		
		function placeShape(x, y, user){
			if((placed[0]& 1 << x+y*3) == 0 && (placed[1]& 1 << x+y*3) == 0){
				placed[user]|= 1 << x+y*3
				draw();
				if (user){
					isPlayerTurn = true;
				}
				
				return true;
			}
			else{
				return false;
			}
		}
		
		function checkPlace(x, y, user){
			if((placed[0]& 1 << x+y*3) != 0 || (placed[1]& 1 << x+y*3) != 0){
				return true;
			}
			else{
				return false;
			}
		}
		
		canvas.addEventListener('mousedown', function(event) {
			let userInputX = Math.floor((event.pageX - canvas.offsetLeft)/(canvas.width/3));
			let userInputY = Math.floor((event.pageY - canvas.offsetTop)/(canvas.height/3));
			if(isPlayerTurn == true){
				placeShape(userInputX, userInputY, 0)
				isPlayerTurn = false;
				comsTurn();
			}
			//console.log(userInputX+", "+userInputY);
		})
	
	</script>
</html>